<!DOCTYPE html>
<html lang="ur">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ğŸ›’ Ø³Ù¹ÙˆØ± Ù„ÙˆÚ©ÛŒØ´Ù† Ø¨Ú¾ÛŒØ¬ÛŒÚº</title>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Nastaliq+Urdu&family=Roboto:wght@400;700&display=swap" rel="stylesheet">
    <style>
        /* Basic Reset & Body Styling */
        body {
            font-family: 'Roboto', sans-serif; /* Fallback for English */
            font-family: 'Noto Nastaliq Urdu', 'Roboto', sans-serif; /* Urdu and English */
            margin: 0;
            padding: 0;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            background: linear-gradient(135deg, #71b7e6, #9b59b6); /* Gradient Background */
            color: #333;
            overflow-x: hidden;
        }

        /* Container for the form */
        .container {
            background-color: #ffffff;
            padding: 30px 40px;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
            width: 100%;
            max-width: 500px;
            text-align: center;
            box-sizing: border-box;
            direction: rtl; /* For Urdu text alignment */
            text-align: right;
        }

        h1 {
            color: #34495e;
            margin-bottom: 25px;
            font-size: 2.2em;
            font-weight: 700;
        }

        /* Form Elements */
        form {
            display: flex;
            flex-direction: column;
            gap: 15px;
        }

        label {
            display: block;
            margin-bottom: 5px;
            font-weight: 600;
            color: #555;
            text-align: right; /* Align label to the right */
        }

        input[type="text"],
        select {
            width: 100%;
            padding: 12px 15px;
            border: 1px solid #ccc;
            border-radius: 8px;
            font-size: 1em;
            color: #333;
            background-color: #f8f8f8;
            transition: all 0.3s ease;
            box-sizing: border-box; /* Include padding in width */
        }

        input[type="text"]:focus,
        select:focus {
            border-color: #71b7e6;
            box-shadow: 0 0 8px rgba(113, 183, 230, 0.3);
            outline: none;
        }

        button {
            background-color: #28a745; /* Green submit button */
            color: white;
            padding: 14px 20px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 1.1em;
            font-weight: 700;
            transition: background-color 0.3s ease, transform 0.2s ease;
            margin-top: 20px;
        }

        button:hover {
            background-color: #218838;
            transform: translateY(-2px);
        }

        button:disabled {
            background-color: #cccccc;
            cursor: not-allowed;
            transform: translateY(0);
        }

        /* Status & Info Display */
        #status {
            margin-top: 20px;
            padding: 12px;
            border-radius: 8px;
            font-size: 1em;
            background-color: #e0f7fa;
            color: #00796b;
            text-align: center;
        }

        #status.error {
            background-color: #ffebee;
            color: #c62828;
        }

        .coords-display {
            margin-top: 15px;
            text-align: right; /* Align coordinates to the right */
            font-size: 0.95em;
            color: #666;
        }

        .coords-display span {
            font-weight: 600;
            color: #444;
        }

        /* Responsive Design */
        @media (max-width: 600px) {
            .container {
                margin: 20px;
                padding: 25px 30px;
            }
            h1 {
                font-size: 1.8em;
            }
            button {
                font-size: 1em;
                padding: 12px 15px;
            }
        }
    </style>
</head>
<body>

    <div class="container">
        <h1>ğŸ›’ Ø³Ù¹ÙˆØ± Ù„ÙˆÚ©ÛŒØ´Ù† Ø¨Ú¾ÛŒØ¬ÛŒÚº</h1>
        
        <form id="locationForm">
            
            <label for="division">ÚˆÙˆÛŒÚ˜Ù† (Division) Ù…Ù†ØªØ®Ø¨ Ú©Ø±ÛŒÚº:</label>
            <select id="division" required>
                <option value="">-- ÚˆÙˆÛŒÚ˜Ù† Ù…Ù†ØªØ®Ø¨ Ú©Ø±ÛŒÚº --</option>
            </select>

            <label for="asm">Ø§Û’ Ø§ÛŒØ³ Ø§ÛŒÙ… (ASM) Ù…Ù†ØªØ®Ø¨ Ú©Ø±ÛŒÚº:</label>
            <select id="asm" required>
                <option value="">-- Ø§Û’ Ø§ÛŒØ³ Ø§ÛŒÙ… Ù…Ù†ØªØ®Ø¨ Ú©Ø±ÛŒÚº --</option>
            </select>

            <label for="area">Ø¹Ù„Ø§Ù‚Û (Area) Ù…Ù†ØªØ®Ø¨ Ú©Ø±ÛŒÚº:</label>
            <select id="area" required>
                <option value="">-- Ø¹Ù„Ø§Ù‚Û Ù…Ù†ØªØ®Ø¨ Ú©Ø±ÛŒÚº --</option>
            </select>
            
            <label for="storeName">Ø³Ù¹ÙˆØ± Ú©Ø§ Ù†Ø§Ù… Ø¯Ø±Ø¬ Ú©Ø±ÛŒÚº:</label>
            <input type="text" id="storeName" placeholder="Ø³Ù¹ÙˆØ± Ú©Ø§ Ù†Ø§Ù… ÛŒÛØ§Úº Ù„Ú©Ú¾ÛŒÚº" required>
            
            <div id="status">Ù„ÙˆÚ©ÛŒØ´Ù† Ø­Ø§ØµÙ„ Ú©Ø±Ù†Û’ Ú©Û’ Ù„ÛŒÛ’ 'Submit' Ù¾Ø± Ú©Ù„Ú© Ú©Ø±ÛŒÚº...</div>

            <button type="submit" id="submitBtn">Ù„ÙˆÚ©ÛŒØ´Ù† Ø­Ø§ØµÙ„ Ú©Ø± Ú©Û’ Google Sheet Ù…ÛŒÚº Submit Ú©Ø±ÛŒÚº</button>

            <div class="coords-display">
                <p>Latitude: <span id="displayLat">...</span></p>
                <p>Longitude: <span id="displayLon">...</span></p>
            </div>

        </form>
    </div>

    <script>
        // *************************************************************************
        // âš ï¸ Ø¨ÛØª Ø¶Ø±ÙˆØ±ÛŒ: Ø¬Ùˆ 'Web app URL' Ø¢Ù¾ Ù†Û’ Apps Script Ø³Û’ Ú©Ø§Ù¾ÛŒ Ú©ÛŒØ§ ÛÛ’ØŒ ÙˆÛ ÛŒÛØ§Úº Ù¾ÛŒØ³Ù¹ Ú©Ø±ÛŒÚº
        // *************************************************************************
        const WEB_APP_URL = 'YOUR_GOOGLE_APPS_SCRIPT_WEB_APP_URL_HERE'; 
        // *************************************************************************

        // Hierarchy Data (ØªØµÙˆÛŒØ± Ø³Û’ Ù†Ú©Ø§Ù„Ø§ Ú¯ÛŒØ§ Ø³Ø§Ø¯Û Ø´Ø¯Û ÚˆÛŒÙ¹Ø§)
        const hierarchyData = {
            "FBRM CENTRAL": {
                "ASM GUJRANWALA": ["GUJRANWALA A", "GUJRANWALA B", "GUJRANWALA C"],
                "ASM LAHORE D": ["LAHORE D/F", "LAHORE D/C", "LAHORE CANTT"],
                "ASM MULTAN": ["MULTAN A", "MULTAN B", "MULTAN C", "MULTAN D"],
                "ASM FAISALABAD": ["FSD A", "FSD B", "FSD C"],
                "ASM SIALKOT": ["SIALKOT A", "SIALKOT B"],
                "ASM SHEIKHUPURA": ["SHEIKHUPURA A", "SHEIKHUPURA B"],
                "ASM SAHIWAL": ["SAHIWAL A", "SAHIWAL B"],
                "ASM BAHAWALPUR": ["BWP A", "BWP B"],
                "ASM RAHIM YAR KHAN": ["RYK A", "RYK B"],
                "ASM ATTOCK": ["ATTOCK A"],
                "ASM DG KHAN": ["DG KHAN A"],
                "ASM JHELUM": ["JHELUM A"],
                "ASM JHANG": ["JHANG A"],
                "ASM KASUR": ["KASUR A"],
                "ASM KHANEWAL": ["KHANEWAL A"],
                "ASM MIANWALI": ["MIANWALI A"],
                "ASM MUZAFFARGARH": ["MUZAFFARGARH A"],
                "ASM OKARA": ["OKARA A"],
                "ASM SAIDPUR": ["SAIDPUR A"],
                "ASM SARGODHA": ["SARGODHA A", "SARGODHA B"],
                "ASM TAXILA": ["TAXILA A"],
                "ASM TOBA TEK SINGH": ["TTS A"],
                "ASM VEHARI": ["VEHARI A"]
            },
            "FBRM NORTH": {
                "ASM RAWALPINDI": ["RWP A", "RWP B", "RWP C", "RWP D"],
                "ASM PESHAWAR": ["PESHAWAR A", "PESHAWAR B", "PESHAWAR C"],
                "ASM ISLAMABAD": ["ISLAMABAD A", "ISLAMABAD B"],
                "ASM ABBOTTABAD": ["ABBOTTABAD A"],
                "ASM BUNER": ["BUNER A"],
                "ASM CHAKWAL": ["CHAKWAL A"],
                "ASM DIR LOWER": ["DIR L A"],
                "ASM SWAT": ["SWAT A"],
                "ASM KOHAT": ["KOHAT A"],
                "ASM MARDAN": ["MARDAN A"],
                "ASM NOWSHERA": ["NOWSHERA A"],
                "ASM SAWABI": ["SWABI A"],
                "ASM WAHP CANTT": ["WAHC A"],
                "ASM BANNU": ["BANNU A"],
                "ASM DERA ISMAIL KHAN": ["DIK A"],
                "ASM HARIPUR": ["HARIPUR A"],
                "ASM KHARIAN": ["KHARIAN A"],
                "ASM MANSEHRA": ["MANSEHRA A"],
                "ASM MINGORA": ["MINGORA A"],
                "ASM PARACHINAR": ["PARACHINAR A"],
                "ASM SAKKARDU": ["SKD A"],
                "ASM GILGIT": ["GILGIT A"],
                "ASM MUZZAFARABAD": ["MUZAF A"],
                "ASM MIRPUR": ["MIRPUR A"],
                "ASM BAGH": ["BAGH A"]
            },
            "FBRM SOUTH": {
                "ASM KARACHI F": ["KHI F"],
                "ASM KARACHI C": ["KHI C", "KHI C/B"],
                "ASM HYDERABAD": ["HYD A", "HYD B"],
                "ASM SUKKUR": ["SUKKUR A"],
                "ASM QUETTA": ["QUETTA A"],
                "ASM LARKANA": ["LARKANA A"],
                "ASM NAWABSHAH": ["NWB A"],
                "ASM CHAMAN": ["CHAMAN A"]
            }
            // à¤†à¤ª à¤¯à¤¹à¤¾à¤‚ à¤…à¤ªà¤¨à¥€ à¤ªà¥‚à¤°à¥€ Hierarchy à¤¶à¤¾à¤®à¤¿à¤² à¤•à¤° à¤¸à¤•à¤¤à¥‡ à¤¹à¥ˆà¤‚
        };

        const divisionSelect = document.getElementById('division');
        const asmSelect = document.getElementById('asm');
        const areaSelect = document.getElementById('area');
        const locationForm = document.getElementById('locationForm');
        const submitBtn = document.getElementById('submitBtn');
        const displayLat = document.getElementById('displayLat');
        const displayLon = document.getElementById('displayLon');


        // ---------------------------------------------------
        // I. Hierarchy Selectors ko Populate karne ka Function
        // ---------------------------------------------------

        function populateDivisions() {
            for (const division in hierarchyData) {
                const option = document.createElement('option');
                option.value = division;
                option.textContent = division;
                divisionSelect.appendChild(option);
            }
        }

        function populateASMs() {
            asmSelect.innerHTML = '<option value="">-- Ø§Û’ Ø§ÛŒØ³ Ø§ÛŒÙ… Ù…Ù†ØªØ®Ø¨ Ú©Ø±ÛŒÚº --</option>'; // Reset
            areaSelect.innerHTML = '<option value="">-- Ø¹Ù„Ø§Ù‚Û Ù…Ù†ØªØ®Ø¨ Ú©Ø±ÛŒÚº --</option>'; // Reset
            
            const selectedDivision = divisionSelect.value;
            if (selectedDivision && hierarchyData[selectedDivision]) {
                for (const asm in hierarchyData[selectedDivision]) {
                    const option = document.createElement('option');
                    option.value = asm;
                    option.textContent = asm;
                    asmSelect.appendChild(option);
                }
            }
        }

        function populateAreas() {
            areaSelect.innerHTML = '<option value="">-- Ø¹Ù„Ø§Ù‚Û Ù…Ù†ØªØ®Ø¨ Ú©Ø±ÛŒÚº --</option>'; // Reset

            const selectedDivision = divisionSelect.value;
            const selectedASM = asmSelect.value;
            
            if (selectedDivision && selectedASM && hierarchyData[selectedDivision][selectedASM]) {
                hierarchyData[selectedDivision][selectedASM].forEach(area => {
                    const option = document.createElement('option');
                    option.value = area;
                    option.textContent = area;
                    areaSelect.appendChild(option);
                });
            }
        }
        
        // Event Listeners
        divisionSelect.addEventListener('change', populateASMs);
        asmSelect.addEventListener('change', populateAreas);

        // Initial load
        populateDivisions();
        
        // ---------------------------------------------------
        // II. Geolocation aur Data Submission Logic
        // ---------------------------------------------------

        locationForm.addEventListener('submit', function(e) {
            e.preventDefault(); 
            
            // 1. Check karein ke form fields bhare hain ya nahin
            if (!divisionSelect.value || !asmSelect.value || !areaSelect.value || !document.getElementById('storeName').value) {
                statusText.textContent = 'âŒ Ø¨Ø±Ø§Û Ú©Ø±Ù… ØªÙ…Ø§Ù… ÙÛŒÙ„ÚˆØ² (ÚˆÙˆÛŒÚ˜Ù†ØŒ Ø§Û’ Ø§ÛŒØ³ Ø§ÛŒÙ…ØŒ Ø¹Ù„Ø§Ù‚ÛØŒ Ø§ÙˆØ± Ø³Ù¹ÙˆØ± Ú©Ø§ Ù†Ø§Ù…) Ø¨Ú¾Ø±ÛŒÚºÛ”';
                statusText.classList.add('error');
                return;
            }

            // 2. Geolocation shuru karein
            if ("geolocation" in navigator) {
                statusText.textContent = 'Ù„ÙˆÚ©ÛŒØ´Ù† Ú©ÛŒ Ø¯Ø±Ø®ÙˆØ§Ø³Øª Ú©ÛŒ Ø¬Ø§ Ø±ÛÛŒ ÛÛ’... (Ø¨Ø±Ø§Û Ú©Ø±Ù… Ù„ÙˆÚ©ÛŒØ´Ù† Ú©ÛŒ Ø§Ø¬Ø§Ø²Øª Ø¯ÛŒÚºÛ”).';
                statusText.classList.remove('error');
                submitBtn.disabled = true; 

                navigator.geolocation.getCurrentPosition(
                    // Success Function
                    (position) => {
                        const lat = position.coords.latitude;
                        const lon = position.coords.longitude;
                        const accuracy = position.coords.accuracy;

                        // Accuracy check
                        if (accuracy > 30) { // Ø§Ú¯Ø± 30 Ù…ÛŒÙ¹Ø± Ø³Û’ Ø²ÛŒØ§Ø¯Û ØºÙ„Ø·ÛŒ ÛÙˆ
                            statusText.textContent = `âš ï¸ Ù„ÙˆÚ©ÛŒØ´Ù† Ù…Ù„ Ú¯Ø¦ÛŒØŒ Ù„ÛŒÚ©Ù† Accuracy Ú©Ù… ÛÛ’ (${Math.round(accuracy)}m). Ø¨ÛØªØ± Accuracy Ú©Û’ Ù„ÛŒÛ’ ØªÚ¾ÙˆÚ‘Ø§ Ø§Ù†ØªØ¸Ø§Ø± Ú©Ø±ÛŒÚº ÛŒØ§ Ú©Ú¾Ù„ÛŒ Ø¬Ú¯Û Ù¾Ø± Ø¯ÙˆØ¨Ø§Ø±Û Ú©ÙˆØ´Ø´ Ú©Ø±ÛŒÚºÛ”`;
                            statusText.classList.add('error');
                            submitBtn.disabled = false;
                            return;
                        }

                        displayLat.textContent = lat;
                        displayLon.textContent = lon;
                        statusText.textContent = `âœ… Ù„ÙˆÚ©ÛŒØ´Ù† Ø­Ø§ØµÙ„: Accuracy ${Math.round(accuracy)}m. ÚˆÛŒÙ¹Ø§ Ø¨Ú¾ÛŒØ¬Ø§ Ø¬Ø§ Ø±ÛØ§ ÛÛ’...`;
                        statusText.classList.remove('error');

                        // 3. Data ko Google Sheet mein bhejein
                        const payload = {
                            division: divisionSelect.value, 
                            asm: asmSelect.value, 
                            area: areaSelect.value, 
                            storeName: document.getElementById('storeName').value,
                            latitude: lat,
                            longitude: lon
                        };

                        fetch(WEB_APP_URL, {
                            method: 'POST',
                            headers: {
                                'Content-Type': 'text/plain;charset=utf-8', 
                            },
                            body: JSON.stringify(payload)
                        })
                        .then(response => response.json())
                        .then(data => {
                            if (data.status === 'SUCCESS') {
                                statusText.textContent = `ğŸ¥³ Ú©Ø§Ù…ÛŒØ§Ø¨ÛŒ! Ø³Ù¹ÙˆØ± '${payload.storeName}' Ú©Ø§ ÚˆÛŒÙ¹Ø§ Google Sheet Ù…ÛŒÚº Ù…Ø­ÙÙˆØ¸ ÛÙˆ Ú¯ÛŒØ§ ÛÛ’Û”`;
                                statusText.classList.remove('error');
                                // Form ko reset kar sakte hain
                                locationForm.reset();
                                displayLat.textContent = '...';
                                displayLon.textContent = '...';
                                populateASMs(); // Reset ASM dropdown
                                populateAreas(); // Reset Area dropdown
                            } else {
                                statusText.textContent = `âŒ Ø®Ø±Ø§Ø¨ÛŒ: ÚˆÛŒÙ¹Ø§ Ù…Ø­ÙÙˆØ¸ Ù†ÛÛŒÚº ÛÙˆ Ø³Ú©Ø§. (${data.message || 'Ù†Ø§Ù…Ø¹Ù„ÙˆÙ… Ø®Ø±Ø§Ø¨ÛŒ'})`;
                                statusText.classList.add('error');
                            }
                            submitBtn.disabled = false;
                        })
                        .catch((error) => {
                            statusText.textContent = `âŒ Ú©Ù…ÛŒÙˆÙ†ÛŒÚ©ÛŒØ´Ù† Ø®Ø±Ø§Ø¨ÛŒ: Web App URL ÛŒØ§ Ø§Ù†Ù¹Ø±Ù†ÛŒÙ¹ Ú©Ù†ÛŒÚ©Ø´Ù† Ú†ÛŒÚ© Ú©Ø±ÛŒÚºÛ”`;
                            statusText.classList.add('error');
                            console.error('Fetch error:', error);
                            submitBtn.disabled = false;
                        });
                        
                    },
                    
                    // Error Function
                    (error) => {
                        submitBtn.disabled = false;
                        let errorMessage = 'Ù„ÙˆÚ©ÛŒØ´Ù† Ø­Ø§ØµÙ„ Ù†ÛÛŒÚº ÛÙˆ Ø³Ú©ÛŒÛ”';
                        if (error.code === error.PERMISSION_DENIED) {
                            errorMessage = "âŒ Ø¢Ù¾ Ù†Û’ Ù„ÙˆÚ©ÛŒØ´Ù† Ø´ÛŒØ¦Ø± Ú©Ø±Ù†Û’ Ú©ÛŒ Ø§Ø¬Ø§Ø²Øª Ù†ÛÛŒÚº Ø¯ÛŒÛ” Ø¨Ø±Ø§Û Ú©Ø±Ù… Ø¨Ø±Ø§Ø¤Ø²Ø± Ú©ÛŒ Ø³ÛŒÙ¹Ù†Ú¯Ø² Ù…ÛŒÚº Ø§Ø¬Ø§Ø²Øª Ø¯ÛŒÚºÛ”";
                        } else if (error.code === error.POSITION_UNAVAILABLE) {
                            errorMessage = "âŒ Ù„ÙˆÚ©ÛŒØ´Ù† Ú©ÛŒ Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø¯Ø³ØªÛŒØ§Ø¨ Ù†ÛÛŒÚºÛ” GPS ÛŒØ§ Ø§Ù†Ù¹Ø±Ù†ÛŒÙ¹ Ú©Ù†ÛŒÚ©Ø´Ù† Ú†ÛŒÚ© Ú©Ø±ÛŒÚºÛ”";
                        } else if (error.code === error.TIMEOUT) {
                            errorMessage = "âŒ Ù„ÙˆÚ©ÛŒØ´Ù† Ø­Ø§ØµÙ„ Ú©Ø±Ù†Û’ Ù…ÛŒÚº Ø¨ÛØª Ø²ÛŒØ§Ø¯Û ÙˆÙ‚Øª Ù„Ú¯ Ú¯ÛŒØ§Û” Ø¯ÙˆØ¨Ø§Ø±Û Ú©ÙˆØ´Ø´ Ú©Ø±ÛŒÚºÛ”";
                        }
                        statusText.textContent = errorMessage;
                        statusText.classList.add('error');
                    },
                    
                    // Options: High Accuracy aur Timeout
                    {
                        enableHighAccuracy: true,   // Ø²ÛŒØ§Ø¯Û Ø¯Ø±Ø³ØªÚ¯ÛŒ Ú©ÛŒ Ú©ÙˆØ´Ø´ Ú©Ø±ÛŒÚº (GPS Ø§Ø³ØªØ¹Ù…Ø§Ù„ Ú©Ø±ÛŒÚº)
                        timeout: 20000,             // 20 Ø³ÛŒÚ©Ù†Úˆ ØªÚ© Ø§Ù†ØªØ¸Ø§Ø± Ú©Ø±ÛŒÚº
                        maximumAge: 0               // Ù¾Ø±Ø§Ù†ÛŒ Ù„ÙˆÚ©ÛŒØ´Ù† Ø§Ø³ØªØ¹Ù…Ø§Ù„ Ù†Û Ú©Ø±ÛŒÚºØŒ ÛÙ…ÛŒØ´Û Ù†Ø¦ÛŒ Ù„ÙˆÚ©ÛŒØ´Ù† Ù„ÛŒÚºÛ”
                    }
                );
                
            } else {
                statusText.textContent = "âŒ Ø¢Ù¾ Ú©Ø§ Ø¨Ø±Ø§Ø¤Ø²Ø± Geolocation Ú©Ùˆ Ø³Ù¾ÙˆØ±Ù¹ Ù†ÛÛŒÚº Ú©Ø±ØªØ§.";
                statusText.classList.add('error');
            }
        });
    </script> 
</body>
</html>
